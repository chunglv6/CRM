package com.viettel.etc.repositories.impl;import com.viettel.etc.dto.SaleTransDTO;import com.viettel.etc.dto.SaleTransVehicleOwnerAppDTO;import com.viettel.etc.repositories.SaleTransRepository;import com.viettel.etc.utils.Constants;import com.viettel.etc.utils.FnCommon;import com.viettel.etc.xlibrary.core.entities.ResultSelectEntity;import com.viettel.etc.xlibrary.core.repositories.CommonDataBaseRepository;import org.springframework.stereotype.Repository;import java.util.ArrayList;import java.util.List;/** * Autogen class Repository Impl: Lop thao tac danh sach lich su * * @author ToolGen * @date Fri Jul 10 10:48:49 ICT 2020 */@Repositorypublic class SaleTransRepositoryImpl extends CommonDataBaseRepository implements SaleTransRepository {    /**     * Lay lich su giao dich khac     *     * @param contractId     * @param saleTransDTO     * @return     */    public ResultSelectEntity findOtherTransactionHistories(Long contractId, SaleTransDTO saleTransDTO) {        StringBuilder sql = new StringBuilder();        List<Object> arrParams = new ArrayList<>();        sql.append("select ");        sql.append(" st.SALE_TRANS_ID                   as saleTransId,                     -- Ma giao dich\n");        sql.append(" st.SALE_TRANS_CODE                 as saleTransCode,                   -- Ma giao dich \n");        sql.append(" std.SERVICE_FEE_NAME               as serviceFeeName,                  -- Loai giao dich\n");        sql.append(" st.SALE_TRANS_DATE                 as saleTransDate,                   -- Thoi gian giao dich\n");        sql.append(" st.AMOUNT                          as amount,                          -- So tien\n");        sql.append(" st.CREATE_USER                     as createUser,                      -- Nguoi tac dong\n");        sql.append(" std.SERVICE_FEE_NAME               as saleTransContent,                -- Noi dung giao dich\n");        sql.append(" std.SERVICE_FEE_ID                 as serviceFeeId                     -- \n");        sql.append(" from SALE_TRANS st, SALE_TRANS_DETAIL std\n");        sql.append(" where ");        sql.append("  st.SALE_TRANS_ID = std.SALE_TRANS_ID (+)\n");        // sale trans type 1 is other transaction        sql.append(" and st.SALE_TRANS_TYPE = 1");        if (contractId != null) {            sql.append(" and st.CONTRACT_ID = ?\n");            arrParams.add(contractId);        }        if (!FnCommon.isNullOrEmpty(saleTransDTO.getSaleTransDateFrom())) {            sql.append(" and st.SALE_TRANS_DATE >= to_date (?, 'dd/MM/yyyy')\n");            arrParams.add(saleTransDTO.getSaleTransDateFrom());        }        if (!FnCommon.isNullOrEmpty(saleTransDTO.getSaleTransDateTo())) {            sql.append(" and st.SALE_TRANS_DATE <= to_date (?, 'dd/MM/yyyy HH24:mi:ss')\n");            arrParams.add(saleTransDTO.getSaleTransDateTo() + Constants.TIME_ONE_DAY);        }        if (saleTransDTO.getServiceFeeId() != null) {            sql.append(" and std.SERVICE_FEE_ID = ?\n");            arrParams.add(saleTransDTO.getServiceFeeId());        }        sql.append(" order by st.SALE_TRANS_DATE desc");        Integer start = null;        if (saleTransDTO.getStartrecord() != null) {            start = saleTransDTO.getStartrecord();        }        Integer pageSize = null;        if (saleTransDTO.getPagesize() != null) {            pageSize = saleTransDTO.getPagesize();        }        return getListDataAndCount(sql, arrParams, start, pageSize, SaleTransDTO.class);    }    /**     * Lay danh sach loai giao dich     *     * @param itemParamsEntity: params client truyen len     * @return     */    @Override    public List<SaleTransDTO> getServiceFees(SaleTransDTO itemParamsEntity) {        StringBuilder sql = new StringBuilder();        sql.append("select SERVICE_FEE_ID as id, SERVICE_FEE_CODE as code, SERVICE_FEE_NAME as name from SERVICE_FEE");        List<Object> arrParams = new ArrayList<>();        Integer start = null;        if (itemParamsEntity != null && itemParamsEntity.getStartrecord() != null) {            start = itemParamsEntity.getStartrecord();        }        Integer pageSize = null;        if (itemParamsEntity != null && itemParamsEntity.getPagesize() != null) {            pageSize = itemParamsEntity.getPagesize();        }        return (List<SaleTransDTO>) getListData(sql, arrParams, start, pageSize, SaleTransDTO.class);    }    /**     * Lay lich su giao dich khac - AppCPT     *     * @param transVehicleOwnerAppDTO     * @return     */    @Override    public ResultSelectEntity vehicleOwnerAppOtherTransactionHistories(SaleTransVehicleOwnerAppDTO transVehicleOwnerAppDTO, Long contractId) {        StringBuilder sbSql = new StringBuilder();        List<Object> arrParams = new ArrayList<>();        sbSql.append("select ");        sbSql.append(" st.sale_trans_code        as saleTransCode,                           -- Ma giao dich\n");        sbSql.append(" sf.service_fee_name       as serviceFeeName,                          -- Loai giao dich\n");        sbSql.append(" ar.name                   as actReasonName,                         -- Li do giao dich\n");        sbSql.append(" at.name                   as actTypeName,                           -- Loai do giao dich\n");        sbSql.append(" st.sale_trans_date        as saleTransDate,                           -- Thoi gian giao dich\n");        sbSql.append(" st.amount                 as amount,                                  -- So tien\n");        sbSql.append(" st.create_user            as createUser                               -- Nguoi tac dong\n");        sbSql.append(" from SALE_TRANS st, SALE_TRANS_DETAIL std, service_fee sf, act_reason ar,act_type at\n");        sbSql.append(" where 1=1\n");        sbSql.append(" AND st.sale_trans_id = std.sale_trans_id(+)\n");        sbSql.append(" AND sf.service_fee_id = std.service_fee_id\n");        sbSql.append(" AND sf.act_type_id = at.act_type_id\n");        sbSql.append(" AND sf.act_reason_id = ar.act_reason_id\n");        sbSql.append(" AND\n");        sbSql.append(" st.CONTRACT_ID = ?\n");        arrParams.add(contractId);        // sale trans type 1 is other transaction        sbSql.append(" and st.SALE_TRANS_TYPE = '1'");        if (!FnCommon.isNullOrEmpty(transVehicleOwnerAppDTO.getPlateNumber())) {            sbSql.append(" and UPPER(std.plate_number) like '%' || UPPER(?) ||'%'\n");            arrParams.add(transVehicleOwnerAppDTO.getPlateNumber());        }        if (!FnCommon.isNullOrEmpty(transVehicleOwnerAppDTO.getFromDate())) {            sbSql.append(" and st.sale_trans_date >= TO_DATE(?, 'dd/mm/yyyy')\n");            arrParams.add(transVehicleOwnerAppDTO.getFromDate());        }        if (!FnCommon.isNullOrEmpty(transVehicleOwnerAppDTO.getToDate())) {            sbSql.append(" and st.sale_trans_date <= TO_DATE(?, 'dd/mm/yyyy HH24:mi:ss')\n");            arrParams.add(transVehicleOwnerAppDTO.getToDate() + Constants.TIME_ONE_DAY);        }        sbSql.append(" order by st.SALE_TRANS_DATE desc");        Integer start = null;        if (transVehicleOwnerAppDTO.getStartrecord() != null) {            start = transVehicleOwnerAppDTO.getStartrecord();        }        Integer pageSize = null;        if (transVehicleOwnerAppDTO.getPagesize() != null) {            pageSize = transVehicleOwnerAppDTO.getPagesize();        }        return getListDataAndCount(sbSql, arrParams, start, pageSize, SaleTransVehicleOwnerAppDTO.class);    }}