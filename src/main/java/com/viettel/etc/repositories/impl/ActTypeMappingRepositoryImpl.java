package com.viettel.etc.repositories.impl;import com.viettel.etc.dto.ActTypeMappingDTO;import com.viettel.etc.repositories.ActTypeMappingRepository;import com.viettel.etc.repositories.tables.entities.ActIdTypeMappingEntity;import com.viettel.etc.services.tables.ActIdTypeMappingServiceJPA;import com.viettel.etc.utils.Constants;import com.viettel.etc.utils.exceptions.EtcException;import com.viettel.etc.utils.FnCommon;import com.viettel.etc.xlibrary.core.repositories.CommonDataBaseRepository;import com.viettel.etc.xlibrary.core.entities.ResultSelectEntity;import java.sql.Date;import org.modelmapper.ModelMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.Authentication;import org.springframework.stereotype.Repository;import java.util.HashMap;/** * Autogen class Repository Impl: Chung to cho loai tac dong * * @author ToolGen * @date Tue Sep 08 09:29:22 ICT 2020 */@Repositorypublic class ActTypeMappingRepositoryImpl extends CommonDataBaseRepository implements ActTypeMappingRepository {    @Autowired    private ActIdTypeMappingServiceJPA actIdTypeMappingServiceJPA;    /**     * Lay danh sach chung tu cho loai tac dong     *     * @param itemParamsEntity: params client truyen len     * @return     */    @Override    public ResultSelectEntity find(ActTypeMappingDTO itemParamsEntity) {        StringBuilder sql = new StringBuilder();        sql.append("select a.ID, a.ACT_TYPE_ID as actTypeId, a.DOCUMENT_TYPE_ID as documentTypeId,")                .append("a.CREATE_DATE as createDate, a.description, a.status\n ")                .append(", b.NAME as actTypeName \n")                .append(", c.NAME as documentTypeName\n")                .append(", c.CODE as documentTypeCode\n")                .append("from ACT_ID_TYPE_MAPPING a \n")                .append("inner join ACT_TYPE b on a.ACT_TYPE_ID = b.ACT_TYPE_ID \n")                .append("inner join DOCUMENT_TYPE c on a.DOCUMENT_TYPE_ID = c.DOCUMENT_TYPE_ID \n")                .append("where 1=1 \n");        HashMap<String, Object> hmapParams = new HashMap<>();        if (itemParamsEntity.getActTypeId() != null) {            sql.append("and a.ACT_TYPE_ID =:actTypeId \n");            hmapParams.put("actTypeId", itemParamsEntity.getActTypeId());        }        if (itemParamsEntity.getDocumentTypeId() != null) {            sql.append("and a.DOCUMENT_TYPE_ID =:documentTypeId \n");            hmapParams.put("documentTypeId", itemParamsEntity.getDocumentTypeId());        }        if (itemParamsEntity.getStatus() != null) {            sql.append("and a.STATUS =:status \n");            hmapParams.put("status", itemParamsEntity.getStatus());        }        sql.append("order by a.UPDATE_DATE,a.CREATE_DATE \n");        Integer start = null;        if (itemParamsEntity.getStartrecord() != null) {            start = itemParamsEntity.getStartrecord();        }        Integer pageSize = null;        if (itemParamsEntity.getPagesize() != null) {            pageSize = itemParamsEntity.getPagesize();        }        return getListDataAndCount(sql, hmapParams, start, pageSize, ActTypeMappingDTO.class);    }    // thêm mới cấu hình    @Override    public Object insert(ActTypeMappingDTO params, Authentication authentication) {        if (actIdTypeMappingServiceJPA.existsByActTypeIdAndDocumentTypeId(params.getActTypeId(), params.getDocumentTypeId())) {            throw new EtcException("crm.validate.act.type.mapping.exits");        }        ModelMapper modelMapper = new ModelMapper();        ActIdTypeMappingEntity obj = modelMapper.map(params, ActIdTypeMappingEntity.class);        obj.setCreateDate(new Date(System.currentTimeMillis()));        obj.setCreateUser(FnCommon.getUserLogin(authentication));        obj.setDescription(params.getDescription().trim());        return actIdTypeMappingServiceJPA.save(obj);    }    // lấy 1    @Override    public ResultSelectEntity findOne(Long id) {        StringBuilder sql = new StringBuilder();        HashMap<String, Object> hmapParams = new HashMap<>();        sql.append("select a.ID, a.ACT_TYPE_ID as actTypeId, a.DOCUMENT_TYPE_ID as documentTypeId, a.description, a.status from ACT_ID_TYPE_MAPPING a where id =:id");        hmapParams.put("id", id);        return getListDataAndCount(sql, hmapParams, 0, 1, ActTypeMappingDTO.class);    }    //    cập nhật trạng thái cấu hình    @Override    public Object updateStatus(Long id, Authentication authentication) {        ActIdTypeMappingEntity obj = actIdTypeMappingServiceJPA.findById(id).get();        obj.setUpdateDate(new Date(System.currentTimeMillis()));        obj.setUpdateUser(FnCommon.getUserLogin(authentication));        if (obj.getStatus().equals(Constants.CATEGORY_STATUS.ACTIVE)) {            obj.setStatus(Constants.CATEGORY_STATUS.INACTIVE);        } else {            obj.setStatus(Constants.CATEGORY_STATUS.ACTIVE);        }        return actIdTypeMappingServiceJPA.save(obj);    }}